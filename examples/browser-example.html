<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blucap - æµè§ˆå™¨ç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .route-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .info-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .loading {
            text-align: center;
            color: #3498db;
        }
        .examples {
            margin-top: 30px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        .example-btn {
            margin: 5px;
            width: auto;
            display: inline-block;
            padding: 8px 15px;
            background: #95a5a6;
        }
        .example-btn:hover {
            background: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— Blucap</h1>
        <p style="text-align: center; color: #7f8c8d;">è¶£å‘³è·¯çº¿ç”Ÿæˆå™¨ - æµè§ˆå™¨æ¼”ç¤º</p>
        
        <!-- API å¯†é’¥é…ç½® -->
        <div class="form-group">
            <label for="apiKey">GraphHopper API å¯†é’¥:</label>
            <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥ä½ çš„ GraphHopper API å¯†é’¥">
            <small style="color: #7f8c8d;">è·å–å…è´¹ API å¯†é’¥: <a href="https://www.graphhopper.com/dashboard/" target="_blank">GraphHopper Dashboard</a></small>
        </div>
        
        <!-- è·¯çº¿ç±»å‹é€‰æ‹© -->
        <div class="form-group">
            <label for="routeType">è·¯çº¿ç±»å‹:</label>
            <select id="routeType" onchange="toggleRouteOptions()">
                <option value="roundtrip">ç¯å½¢è·¯çº¿</option>
                <option value="point-to-point">ç‚¹å¯¹ç‚¹è·¯çº¿</option>
            </select>
        </div>
        
        <!-- èµ·å§‹ç‚¹ -->
        <div class="form-group">
            <label for="startPoint">èµ·å§‹ç‚¹ (çº¬åº¦, ç»åº¦):</label>
            <input type="text" id="startPoint" placeholder="ä¾‹å¦‚: 39.9042, 116.4074" value="39.9042, 116.4074">
        </div>
        
        <!-- ç»ˆç‚¹ (ä»…ç‚¹å¯¹ç‚¹è·¯çº¿) -->
        <div class="form-group" id="endPointGroup" style="display: none;">
            <label for="endPoint">ç»ˆç‚¹ (çº¬åº¦, ç»åº¦):</label>
            <input type="text" id="endPoint" placeholder="ä¾‹å¦‚: 31.2304, 121.4737" value="31.2304, 121.4737">
        </div>
        
        <!-- è·ç¦»è®¾ç½® -->
        <div class="form-group">
            <label for="distance">ç›®æ ‡è·ç¦» (km):</label>
            <input type="number" id="distance" min="50" max="500" value="120">
        </div>
        
        <!-- å¼¯é“ç­‰çº§ -->
        <div class="form-group">
            <label for="curveLevel">å¼¯é“ç­‰çº§:</label>
            <select id="curveLevel">
                <option value="low">ä½ - æœ€å¿«è·¯çº¿</option>
                <option value="medium" selected>ä¸­ - å¹³è¡¡è·¯çº¿</option>
                <option value="high">é«˜ - é£æ™¯è·¯çº¿</option>
            </select>
        </div>
        
        <!-- èµ·å§‹æ–¹å‘ (ä»…ç¯å½¢è·¯çº¿) -->
        <div class="form-group" id="bearingGroup">
            <label for="startBearing">èµ·å§‹æ–¹å‘ (åº¦):</label>
            <input type="number" id="startBearing" min="0" max="360" value="0">
            <small style="color: #7f8c8d;">0=åŒ—, 90=ä¸œ, 180=å—, 270=è¥¿</small>
        </div>
        
        <!-- ç”ŸæˆæŒ‰é’® -->
        <button onclick="generateRoute()" id="generateBtn">ğŸš€ ç”Ÿæˆè·¯çº¿</button>
        
        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="result" class="result">
            <div id="loading" class="loading" style="display: none;">
                <p>ğŸ”„ æ­£åœ¨ç”Ÿæˆè·¯çº¿ï¼Œè¯·ç¨å€™...</p>
            </div>
            <div id="routeResult" style="display: none;">
                <h3>âœ… è·¯çº¿ç”ŸæˆæˆåŠŸ!</h3>
                <div class="route-info">
                    <div class="info-card">
                        <div class="info-value" id="routeDistance">-</div>
                        <div class="info-label">æ€»è·ç¦» (km)</div>
                    </div>
                    <div class="info-card">
                        <div class="info-value" id="routeTime">-</div>
                        <div class="info-label">é¢„è®¡æ—¶é—´ (åˆ†é’Ÿ)</div>
                    </div>
                    <div class="info-card">
                        <div class="info-value" id="routeInstructions">-</div>
                        <div class="info-label">å¯¼èˆªæŒ‡ä»¤æ•°</div>
                    </div>
                </div>
                <details style="margin-top: 15px;">
                    <summary>æŸ¥çœ‹è¯¦ç»†è·¯çº¿æ•°æ®</summary>
                    <pre id="routeData" style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px;"></pre>
                </details>
            </div>
            <div id="errorResult" style="display: none;">
                <h3>âŒ è·¯çº¿ç”Ÿæˆå¤±è´¥</h3>
                <p id="errorMessage"></p>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹æŒ‰é’® -->
        <div class="examples">
            <h3>ğŸ¯ å¿«é€Ÿç¤ºä¾‹</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¿«é€Ÿå¡«å……ç¤ºä¾‹æ•°æ®:</p>
            <button class="example-btn" onclick="loadExample('beijing-roundtrip')">åŒ—äº¬ç¯å½¢è·¯çº¿</button>
            <button class="example-btn" onclick="loadExample('shanghai-hangzhou')">ä¸Šæµ·åˆ°æ­å·</button>
            <button class="example-btn" onclick="loadExample('scenic-route')">é£æ™¯ç»•è¡Œè·¯çº¿</button>
            <button class="example-btn" onclick="loadExample('short-trip')">çŸ­é€”è·¯çº¿</button>
        </div>
    </div>
    
    <!-- å¼•å…¥ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../dist/blucap.min.js"></script>
    
    <script>
        let generator = null;
        
        // åˆ‡æ¢è·¯çº¿é€‰é¡¹æ˜¾ç¤º
        function toggleRouteOptions() {
            const routeType = document.getElementById('routeType').value;
            const endPointGroup = document.getElementById('endPointGroup');
            const bearingGroup = document.getElementById('bearingGroup');
            
            if (routeType === 'point-to-point') {
                endPointGroup.style.display = 'block';
                bearingGroup.style.display = 'none';
            } else {
                endPointGroup.style.display = 'none';
                bearingGroup.style.display = 'block';
            }
        }
        
        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadExample(type) {
            const examples = {
                'beijing-roundtrip': {
                    routeType: 'roundtrip',
                    startPoint: '39.9042, 116.4074',
                    distance: 120,
                    curveLevel: 'medium',
                    startBearing: 90
                },
                'shanghai-hangzhou': {
                    routeType: 'point-to-point',
                    startPoint: '31.2304, 121.4737',
                    endPoint: '30.2741, 120.1551',
                    distance: 200,
                    curveLevel: 'low'
                },
                'scenic-route': {
                    routeType: 'point-to-point',
                    startPoint: '22.3193, 114.1694',
                    endPoint: '22.1987, 113.5439',
                    distance: 300,
                    curveLevel: 'high'
                },
                'short-trip': {
                    routeType: 'roundtrip',
                    startPoint: '25.0330, 121.5654',
                    distance: 80,
                    curveLevel: 'medium',
                    startBearing: 0
                }
            };
            
            const example = examples[type];
            if (example) {
                document.getElementById('routeType').value = example.routeType;
                document.getElementById('startPoint').value = example.startPoint;
                document.getElementById('distance').value = example.distance;
                document.getElementById('curveLevel').value = example.curveLevel;
                
                if (example.endPoint) {
                    document.getElementById('endPoint').value = example.endPoint;
                }
                if (example.startBearing !== undefined) {
                    document.getElementById('startBearing').value = example.startBearing;
                }
                
                toggleRouteOptions();
            }
        }
        
        // è§£æåæ ‡ç‚¹
        function parsePoint(pointStr) {
            const parts = pointStr.split(',').map(s => parseFloat(s.trim()));
            if (parts.length !== 2 || parts.some(isNaN)) {
                throw new Error('åæ ‡æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ "çº¬åº¦, ç»åº¦" æ ¼å¼');
            }
            return parts;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(type, data = null) {
            const result = document.getElementById('result');
            const loading = document.getElementById('loading');
            const routeResult = document.getElementById('routeResult');
            const errorResult = document.getElementById('errorResult');
            
            // éšè—æ‰€æœ‰å­å…ƒç´ 
            loading.style.display = 'none';
            routeResult.style.display = 'none';
            errorResult.style.display = 'none';
            
            result.className = 'result';
            result.style.display = 'block';
            
            if (type === 'loading') {
                loading.style.display = 'block';
            } else if (type === 'success') {
                result.classList.add('success');
                routeResult.style.display = 'block';
                
                // å¡«å……è·¯çº¿ä¿¡æ¯
                const path = data.paths[0];
                document.getElementById('routeDistance').textContent = (path.distance / 1000).toFixed(1);
                document.getElementById('routeTime').textContent = (path.time / 60000).toFixed(0);
                document.getElementById('routeInstructions').textContent = path.instructions.length;
                document.getElementById('routeData').textContent = JSON.stringify(data, null, 2);
                
            } else if (type === 'error') {
                result.classList.add('error');
                errorResult.style.display = 'block';
                document.getElementById('errorMessage').textContent = data;
            }
        }
        
        // ç”Ÿæˆè·¯çº¿
        async function generateRoute() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const routeType = document.getElementById('routeType').value;
            const startPointStr = document.getElementById('startPoint').value.trim();
            const distance = parseInt(document.getElementById('distance').value);
            const curveLevel = document.getElementById('curveLevel').value;
            
            // éªŒè¯è¾“å…¥
            if (!apiKey) {
                showResult('error', 'è¯·è¾“å…¥ GraphHopper API å¯†é’¥');
                return;
            }
            
            if (!startPointStr) {
                showResult('error', 'è¯·è¾“å…¥èµ·å§‹ç‚¹åæ ‡');
                return;
            }
            
            try {
                // åˆ›å»ºç”Ÿæˆå™¨å®ä¾‹
                if (!generator || generator.config.apiKey !== apiKey) {
                    generator = new Blucap({
                        apiKey: apiKey,
                        locale: 'zh'
                    });
                }
                
                // è§£æåæ ‡
                const startPoint = parsePoint(startPointStr);
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showResult('loading');
                document.getElementById('generateBtn').disabled = true;
                
                let route;
                
                if (routeType === 'roundtrip') {
                    // ç¯å½¢è·¯çº¿
                    const startBearing = parseInt(document.getElementById('startBearing').value) || 0;
                    
                    route = await generator.generateRoundTrip({
                        startPoint: startPoint,
                        distance: distance,
                        curveLevel: curveLevel,
                        startBearing: startBearing
                    });
                } else {
                    // ç‚¹å¯¹ç‚¹è·¯çº¿
                    const endPointStr = document.getElementById('endPoint').value.trim();
                    if (!endPointStr) {
                        throw new Error('è¯·è¾“å…¥ç»ˆç‚¹åæ ‡');
                    }
                    
                    const endPoint = parsePoint(endPointStr);
                    
                    route = await generator.generatePointToPoint({
                        startPoint: startPoint,
                        endPoint: endPoint,
                        curveLevel: curveLevel,
                        targetDistance: distance
                    });
                }
                
                // æ˜¾ç¤ºæˆåŠŸç»“æœ
                showResult('success', route);
                
            } catch (error) {
                console.error('è·¯çº¿ç”Ÿæˆé”™è¯¯:', error);
                showResult('error', error.message);
            } finally {
                document.getElementById('generateBtn').disabled = false;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            toggleRouteOptions();
        });
    </script>
</body>
</html>